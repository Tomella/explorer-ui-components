!function(e){"use strict";e.module("explorer.assets",["explorer.projects"]).factory("assetsService",["$log","$http","$q","projectsService","$timeout",function(t,n,o,r,i){function a(e){e="Explorer",t.debug(l+encodeURIComponent(e)),n.get(l+e+"?t="+u,{cache:!0}).success(function(e){s=e,c.forEach(function(e){e.resolve(s)})})}var s,c=[],l="service/asset/assets/",u=Date.now();return r.getCurrentProject().then(a),{getAsset:function(e){return s[e]},getAssets:function(){var e;return s?o.when(s):(e=o.defer(),c.push(e),e.promise)},getReferenceFeatureClasses:function(){var t=o.defer();return this.getAssets().then(function(n){var o=[];e.forEach(n,function(e,t){"REFERENCE_FEATURE_CLASS"==e.assetType&&this.push(e)},o),t.resolve(o)}),t.promise},getResourceKey:function(e){return e.assetId},getResource:function(e){return this.getAsset(e)}}}])}(angular),angular.module("explorer.broker",[]).factory("brokerService",["$log",function(e){var t={};return{register:function(e,n){e in t||(t[e]={}),t[e][n]=n},deregister:function(e,n){e in t&&n in t[e]&&delete t[e][n]},route:function(n){n.jobName&&t[n.jobName]?angular.forEach(t[n.jobName],function(e){e.process(n)}):e.debug("No handler found for "+n.jobName)}}}]),function(e){"use strict";e.module("explorer.asynch",[]).provider("asynch",function(){function t(t){var n=[];return e.forEach(t,function(e,t){n.push(t+"="+encodeURIComponent(e))}),n.join("&")}var n="process/initiateJob",o="process/checkStatus",r=9e3,i=3e3,a="slow",s={},c=0,l=0,u=null,p=null,f={};this.url=function(e){n=e},this.statusUrl=function(e){o=e},this.broker=function(e){p=e},this.idlePoll=function(e){r=e},this.waitingPoll=function(e){i=e},this.$get=["$log","$http","$q","$timeout",function(d,m,h,g){function v(){if(m({url:o,method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t(f)}).then(function(e){var t=e.data&&e.data.messages?e.data.messages:[];l--,t.forEach(function(e){var t=s[e.processkey];t&&t.promise?(c-=1,t.promise.resolve(e),delete s[e.processkey]):(d.debug("Delegate to broker. Message received for non-existant processKey = "+e.processkey),p&&p.route(e))}),1>c&&1>l&&(a="slow",l=c=0),g.cancel(u),u=g(v,"slow"==a?r:i)},function(e){l--,g.cancel(u),u=g(v,r),d.debug("We have an error in the asynch provider:"+JSON.stringify(e))}),1>c&&1>l)a="slow";else{var n=Date.now();e.forEach(s,function(e,t){e.expires<n&&(c-=1,delete s[t],e.promise.reject({error:"expired job"}))})}}function w(o,r,l){var p=h.defer(),w={job:o},y=e.extend({},f,r),b=l?l.urlEncoded:!1,x=l?l.noWait:!1,$=Date.now(),k=l.timeToLive?l.timeToLive:600,S=$+1e3*k;return b&&(w["Content-Type"]="application/x-www-form-urlencoded",y=t(y)),m({url:n,method:"post",headers:w,data:y}).then(function(e){var t=e.headers();x?p.resolve(e.data):(s[t.processkey]={promise:p,expires:S},"slow"==a&&(g.cancel(u),a="fast",u=g(v,i)),++c)},function(e){d.debug(JSON.stringify(e))}),p.promise}return u=g(v,"slow"==a?r:i),w.setBroker=function(e){p=e},w.addParameter=function(e,t){f[e]=t},w.expect=function(){l=5,a="fast"},w}]})}(angular),function(e){"use strict";e.module("explorer.config",["explorer.httpdata","explorer.waiting"]).provider("configService",function(){var e,t,n="service/appConfig/config",o="service/appConfig/config?t=",r=Date.now()%1e7;this.location=function(e){n=e},this.dynamicLocation=function(e){o=e},this.$get=["$q","httpData","waiting",function(i,a,s){var c={getConfig:function(e){var t;return e?(t=i.defer(),this._getConfig().then(function(n){t.resolve(n[e])}),t.promise):this._getConfig()},_getConfig:function(){var c;return t||(t=s.wait()),e?i.when(e):(c=t.waiter(),t.length<2&&a.get(n,{cache:!0}).then(function(n){function i(){e=n,n.localClientSessionId=n.clientSessionId+"-"+r,t.resolve(n),t=null}n.clientSessionId&&n.version?i():a.get(o+Date.now()).then(function(e){n.clientSessionId=e.clientSessionId,n.version=e.version,i()})}),c.promise)}};return c}]})}(angular),angular.module("explorer.confirm",["ui.bootstrap","explorer.focusme"]).directive("expConfirm",["confirmService",function(e){return{scope:{success:"&",cancel:"&",expConfirm:"="},link:function(t,n){n.on("click",function(n){e.confirm(t)})}}}]).factory("confirmService",["$log","$modal",function(e,t){return{confirm:function(n){var o;n.confirmed=!1,o=t.open({templateUrl:"components/confirm/confirm.html",size:"sm",backdrop:"static",keyboard:!1,controller:["$scope","$modalInstance","message",function(e,t,n){e.message=n,e.accept=function(){t.close(!0)},e.reject=function(){t.close(!1)}}],resolve:{message:function(){return n.expConfirm}}}),o.opened.then(function(){}),o.result.then(function(t){e.info("Confirmed : "+t),t?n.success():n.cancel&&n.cancel()})}}}]),angular.module("explorer.drag",[]).directive("dragParent",["$document","$timeout",function(e,t){return{link:function(n,o,r){function i(e){var n=e.pageX-s,o=e.pageY-c,r=document.body.getBoundingClientRect();n<10-l.width?n=10-l.width:n>r.width-10&&(n=r.width-10),0>o?o=0:o>r.height-25&&(o=r.height-25),p.css({top:o+"px",left:n+"px",right:"",bottom:""}),t.cancel(u),u=t(a,2e3)}function a(){e.off("mousemove",i),e.off("mouseup",a)}var s,c,l,u,p=null;o.css({cursor:"pointer"}),o.on("mousedown",function(n){n.preventDefault(),p||(p=o,r.parentclass&&(p=o.closest("."+r.parentclass))),u=t(a,2e3),l=p[0].getBoundingClientRect(),c=n.pageY-l.top,s=n.pageX-l.left,e.on("mousemove",i),e.on("mouseup",a)})}}}]),angular.module("explorer.enter",[]).directive("expEnter",[function(){return{scope:{expEnter:"&"},link:function(e,t,n){t.on("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.expEnter()}),t.preventDefault())})}}}]),function(e,t){"use strict";e.module("explorer.feature.indicator",["explorer.projects"]).factory("indicatorService",["$log","$q","$http","$rootScope","projectsService","assetsService",function(n,o,r,i,a,s){var c="service/asset/counts",l=null,u=null,p=null;return{checkImpact:function(n){var i,f=p=new Date;return l&&l.resolve(null),i=l=o.defer(),a.getCurrentProject().then(function(o){o="Explorer",r.post(c,{wkt:n,md5:u,project:o}).success(function(n,o){if(f==p&&n.refreshRequired)if(200==o)s.getAssets().then(function(t){var o=n.countMap;u=n.md5,e.forEach(t,function(e,t){e.count=o[t]?o[t]:0})});else{var r="We have problem checking indicators.";n&&(e.isString(n)&&(r=t.parse(n)),n.error&&(r=n.error))}i.resolve(n),l=null})}),i.promise}}}])}(angular,JSON),angular.module("explorer.flasher",[]).factory("flashService",["$timeout",function(e){var t={items:[]};return{getData:function(){return t},add:function(n,o,r){"undefined"==typeof r&&(r=!1);var i={text:n,spinner:r,service:this,remove:function(){this.service.remove(this)}},a=this;return o=o?o:1e4,t.items.push(i),i.timer=e(function(){i.timer=null,a.remove(i)},o),i},remove:function(n){if(n){n.timer&&e.cancel(n.timer);var o=t.items.indexOf(n);o>-1&&t.items.splice(o,1)}}}}]).directive("explorerFlash",["flashService","$timeout",function(e,t){return{restrict:"AE",controller:["$scope","flashService",function(e,t){e.messages=t.getData()}],templateUrl:"components/flasher/flash.html",link:function(e,t,n){t.addClass("marsFlash")}}}]).run(["$templateCache",function(e){e.put("components/flasher/flash.html",'<div class="marsFlash" ng-show="messages.items.length > 0">  <div ng-repeat="message in messages.items">     <span><img alt="Waiting..." src="resources/img/tinyloader.gif" ng-show="message.spinner" style="position:relative;top:2px;" width="12"></img> {{message.text}}</span>  </div></div>')}]),angular.module("explorer.focusme",[]).directive("focusMe",["$log","$timeout",function(e,t){return{link:function(e,n,o){o.$observe("focusMe",function(e){"true"===e&&t(function(){n.focus()})})}}}]),angular.module("page.footer",[]).directive("pageFooter",[function(){return{restrict:"EA",templateUrl:"components/footer/footer.html"}}]).run(["$templateCache",function(e){e.put("components/footer/footer.html",'<nav class="navbar navbar-inverse navbar-fixed-bottom ga-footer" role="navigation" explorer-footer>  <div class="container-fluid">    <div class="navbar-header">      <button type="button" class="navbar-toggle" data-toggle="collapse"            data-target="#bs-example-navbar-collapse-1">        <span class="sr-only">Toggle footer</span>        <span class="icon-bar"></span>        <span class="icon-bar"></span>        <span class="icon-bar"></span>      </button>    </div>    <div class="navbar-nobrand">      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">        <ul class="nav navbar-nav">          <li><a href="http://creativecommons.org/licenses/by/3.0/au/deed.en"><img               src="assets/img/cc-by.png" height="20px" alt="CC BY 3.0 AU"/></a></li>          <li><a href="http://www.ga.gov.au/copyright">Copyright</a></li>          <li><a href="http://www.ga.gov.au/disclaimer">Disclaimer</a></li>          <li><a href="http://www.ga.gov.au/privacy">Privacy</a></li>          <li><a href="http://www.ga.gov.au/accessibility">Accessibility</a></li>          <li><a href="http://www.ga.gov.au/ips">Information Publication Scheme</a></li>          <li><a href="http://www.ga.gov.au/ips/foi">Freedom of Information</a></li>          <li class="contact"><a href="http://www.ga.gov.au/contact-us" target="_blank">Contact us</a></li>        </ul>      </div>    </div>  </div></nav>')}]).directive("explorerFooter",["$timeout",function(e){return{restrict:"EA",controller:["$scope",function(e){}],link:function(t,n,o){function r(e){n.delay(e).animate({bottom:-t.originalHeight+7},1e3,function(){t.hidden=!0})}function i(){n.animate({bottom:0},1e3,function(){t.hidden=!1})}t.originalHeight=n.height(),n.on("mouseenter",function(n){t.timeout&&(e.cancel(t.timeout),t.timeout=null),t.timeout=e(function(){i(),t.timeout=null},300)}),n.on("mouseleave",function(){null!=t.timeout?(e.cancel(t.timeout),t.timeout=null):r(0)}),r(3e3)}}}]),angular.module("graph",[]).directive("explorerGraph",["$log",function(e){var t=90;return{templateUrl:"components/graph/lineGraph.html?v=1",scope:{data:"=",config:"=",enter:"&",leave:"&",move:"&",click:"&",showZeroLine:"="},controller:["$scope",function(e){e.round=function(e){return Math.round(e)},e.showZeroLine=!!e.showZeroLine}],link:function(n,o){function r(t){var r,i,a=o.find("svg")[0],s=a.getBoundingClientRect(),c=1050/s.width,l=Math.floor((t.pageX-s.left)*c-48);n.lastIndex!=l&&(n.lastIndex=l,l>-1&&1e3>l?(r=[],n.data.forEach(function(t){var n=Math.round(l*t.data.length/1e3),o=t.data[n];e.debug(n),r.push({index:n,point:o})}),i=l,n.position={index:l,percentX:(l+1)/10,rangeY:n.rangeY,y:{range:n.rangeY,max:n.maxY,min:n.minY},graphX:i,graphY:t.pageY-s.top,pageX:t.pageX,pageY:t.pageY,points:r,point:r.length>0?r[0].point:null}):n.position=null)}function i(o){function r(e,t,n){var o,r=t-e;return n||(n=5),o=5>r?1:12>r?2:24>r?5:60>r?10:120>r?20:240>r?50:600>r?100:1200>r?200:2400>r?500:6e3>r?1e3:12e3>r?2e3:24e3>r?5e3:6e4>r?1e4:2e4,d3.range(e-Math.abs(e%o)+o,t+(o-Math.abs(t%o)),o)}o||(o=[[]]),e.debug(o.length);var i=[];o.forEach(function(e){e.data&&i.push.apply(i,e.data)}),n.minY=d3.min(i,function(e){return e.z}),n.maxY=d3.max(i,function(e){return e.z}),n.rangeY=n.maxY-n.minY,n.yTicks=r(n.minY,n.maxY),n.y=d3.scale.linear().range([t,0]),n.y.domain(d3.extent(i,function(e){return e.z}))}n.mouseLeave=function(e){n.position=null,n.leave&&n.leave({event:e})},n.mouseEnter=function(e){n.enter&&n.enter({event:e})},n.mouseMove=function(e){r(e),e.position=n.position,n.move&&n.move({event:e})},n.mouseClick=function(e){e.preventDefault(),n.click&&(e.position=n.position,n.click({event:e}))},n.$watch("data",i),i()}}}]).directive("explorerLine",[function(){var e=1e3,t=90;return{restrict:"AE",controller:["$scope",function(n){function o(o){var i=o.data;if(!i||!i.length)return void(n.calculateLines=n.calculatePath=r);window.scopers||(window.scopers={}),window.scopers[n.$id]=n,n.minX=0,n.maxX=i.length,n.rangeX=i.length,n.deltaLength=1;var a=d3.time.scale().range([0,e]),s=n.y;a.domain(d3.extent(i,function(e,t){return t})),n.calculatePath=d3.svg.area().interpolate("monotone").x(function(e,t){return a(t)}).y0(t).y1(function(e){return s(null!=e.z?e.z:n.minY)}),n.calculateLine=d3.svg.line().interpolate("monotone").x(function(e,t){return a(t)}).y(function(e){return s(null!=e.z?e.z:n.minY)}),n.line=n.calculateLine(i),n.path=n.calculatePath(i)}function r(){return""}n.$watch("points",o)}]}}]),angular.module("explorer.googleanalytics",[]).directive("expGa",["$window","ga",function(e,t){return{restrict:"A",replace:!1,scope:{expGa:"="},link:function(e,n,o){function r(){t(e.expGa)}var i=o.gaOn||"click";"init"==i?r(e.ga):n.on(i,r)}}}]).factory("ga",["$log","$window",function(e,t){return function(){t.ga?t.ga.apply(this,arguments):(e.warn("No Google Analytics"),e.warn(scope.expGa))}}]),angular.module("explorer.header",[]).controller("headerController",["$scope","$q","$timeout",function(e,t,n){var o=function(e){return e};e.$on("headerUpdated",function(t,n){e.headerConfig=o(n)})}]).directive("explorerHeader",[function(){var e={heading:"Geoscience Australia",headingtitle:"Geoscience Australia",helpurl:"help.html",helptitle:"Get help about Geoscience Australia",helpalttext:"Get help about Geoscience Australia",skiptocontenttitle:"Skip to content",skiptocontent:"Skip to content",quicklinksurl:"/search/api/quickLinks/json?lang=en-US"};return{transclude:!0,restrict:"EA",templateUrl:"components/header/header.html?v=1",scope:{heading:"=",headingtitle:"=",helpurl:"=",helptitle:"=",helpalttext:"=",skiptocontenttitle:"=",skiptocontent:"=",quicklinksurl:"="},link:function(t,n,o){angular.copy(e);angular.forEach(e,function(e,n){n in t||(t[n]=e)})}}}]),angular.module("explorer.height.delta",[]).directive("heightDelta",["$timeout",function(e){return{link:function(t,n,o){function r(e){var t,r,i,a=o.heightDelta;a&&(t=JSON.parse(a),r=$(t.selector).height(),i=r+t.delta,(!t.min||i>t.min)&&n.height(i))}$(window).on("resize",function(){r(!1)}),e(function(){r(!0)})}}}]),angular.module("explorer.httpdata",[]).factory("httpData",["$http","$q",function(e,t){return{get:function(e,t){return this._method("get",e,t)},post:function(e,t){return this._method("post",e,t)},put:function(e,t){return this._method("put",e,t)},_method:function(n,o,r){var i=t.defer();return e[n](o,r).then(function(e){i.resolve(e?e.data:null)},function(e){i.reject(e)}),i.promise}}}]),angular.module("explorer.httpinterceptors",["explorer.httpinterceptors.message","explorer.httpinterceptors.authentication"]),angular.module("explorer.httpinterceptors.message",[]).factory("messageHttpInterceptor",["$q","$log","messageService",function(e,t,n){var o=function(e){var t,o=e?e.data:null;angular.isObject(o)&&"text"in o&&"code"in o&&("type"in o||"severity"in o)&&(t={text:e.data.text,type:(e.data.type?e.data.type:e.data.severity).toLowerCase(),show:!0},n[t.type](t.text))};return{response:function(e){return o(e),e},responseError:function(t){return o(t),e.reject(t)}}}]).config(["$httpProvider",function(e){e.interceptors.push("messageHttpInterceptor")}]),angular.module("explorer.httpinterceptors.authentication",[]).factory("expHttpInterceptor",["$rootScope","$q",function(e,t){return{responseError:function(t){if(t&&401!==t.status&&0!==t.status&&302!==t.status){if(403!==t.status)return t;e.$broadcast("unauthorized")}else window.location.reload()}}}]).config(["$httpProvider",function(e){e.interceptors.push("expHttpInterceptor")}]),angular.module("explorer.info",[]).directive("expInfo",["$document","$animate",function(e,t){return{restrict:"EA",transclude:!0,replace:!0,scope:{title:"@",isOpen:"="},templateUrl:"components/info/info.html?v=1",link:function(t,n){function o(e){27==e.which&&(e.stopPropagation(),e.preventDefault(),t.$apply(function(){t.isOpen=!1}))}t.$watch("isOpen",function(n){n?e.on("keyup",o):e.off("keyup",o),t.$on("$destroy",function(){e.off("keyup",o)})})}}}]),angular.module("knob",[]).directive("knob",["$document",function(e){var t={circleColor:"#A33F1F",min:0,max:10,startAngle:0,pointerColor:"#72C7E7",degrees:30,label:""},n=1;return{templateUrl:"components/knob/knob.html",restrict:"AE",scope:{knob:"=",value:"=",disabled:"=?",mapToPercentage:"=?",mapFromPercentage:"=?"},link:function(o,r){function i(e){var t=e.keyCode;!o.disabled&&t>=37&&40>=t&&o.$apply(function(){e.preventDefault();var n=1+9*e.shiftKey;l({37:-1,38:1,39:1,40:-1}[t]*n)})}function a(e){o.disabled||o.$apply(function(){var t=-e.detail||e.wheelDeltaX,n=-e.detail||e.wheelDeltaY,o=t>0||n>0?1:0>t||0>n?-1:0;e.preventDefault(),l(o)})}function s(t,n){var i=r[0].getBoundingClientRect();o.disabled||(o.centerX=i.left+i.width/2,o.centerY=i.top+i.height/2,e.on(t,c),e.on(n,function(){e.off(t,c)}))}function c(e){var t,n=e.changedTouches?e.changedTouches[0]:e,r=o.centerX-n.pageX,i=o.centerY-n.pageY,a=180*Math.atan2(-i,-r)/Math.PI+90-o.config.startAngle;e.preventDefault(),0>a&&(a+=360),a%=360,t=a<=o.range?Math.max(Math.min(1,a/o.range),0):+(a-o.range<(360-o.range)/2),t=100*t,o.value=o.mapFromPercentage.bind(o.config)(t),o.$apply()}function l(e){var t;o.angle=u(o.angle+o.config.degrees*e),t=(o.angle-o.config.startAngle)/o.range*100,o.value=o.mapFromPercentage.bind(o.config)(t)}function u(e){var t=o.config.startAngle+o.range;return e<o.config.startAngle?o.config.startAngle:e>t?t:e}var p,f={keydown:i.bind(this),mousewheel:a.bind(this),DOMMouseScroll:a.bind(this),touchstart:s.bind(this,"touchmove","touchend"),mousedown:s.bind(this,"mousemove","mouseup")};o.knobShadow="knobshadow_"+n++,r[0].tabIndex=0;for(var d in f)r.on(d,f[d]);if(!o.knob.ticks&&!o.knob.step&&angular.isNumber(o.knob.min)&&angular.isNumber(o.knob.max)&&(o.knob.steps=o.knob.max-o.knob.min,o.knob.step=1),o.config=angular.extend({},t,o.knob),o.knob&&o.knob.ticks)o.ticks=o.config.ticks=o.knob.ticks;else{for(o.ticks=[],p=0;p<=o.config.steps;p++)o.ticks[p]=o.config.min+p*o.config.step;o.config.ticks=o.ticks}o.range=(o.ticks.length-1)*o.config.degrees,o.checkDisabled=function(){return o.disabled?"opacity:0.5;cursor:auto":"cursor:grab"},o.mapToPercentage||(o.mapToPercentage=function(e){var t=this.max-this.min;return(e-this.min)/t*100}),o.mapFromPercentage||(o.mapFromPercentage=function(e){return this.min+(this.max-this.min)*e/100}),o.$watch("value",function(e){o.percentage=o.mapToPercentage.bind(o.config)(e),o.angle=o.config.startAngle+o.range*o.percentage/100})}}}]),angular.module("explorer.legend",[]).directive("explorerLegend",["$modal",function(e){return{scope:{legend:"=",heading:"=?"},controller:["$scope",function(e){e.heading||(e.heading="Legend"),e.showing=!1}],link:function(t,n){var o;n.on("click",function(){return t.showing?void o.close(null):(o=e.open({templateUrl:"components/legend/legend.html",windowClass:"legendContainer",size:"sm",controller:["$scope","$modalInstance","legend","heading",function(e,t,n,o){e.legend=n,e.heading=o}],backdrop:!1,resolve:{legend:function(){return t.legend},heading:function(){return t.heading}}}),o.result.then(function(){t.showing=!1},function(){t.showing=!1}),void(t.showing=!0))})}}}]),angular.module("explorer.message",[]).directive("explorerMessages",["messageService",function(e){return{restrict:"AE",controller:"MessageController",templateUrl:"components/message/messages.html?v=1",link:function(e,t,n,o){}}}]).factory("messageService",["$rootScope",function(e){return{warn:function(e){this._message("warn",e)},success:function(e){this._message("success",e)},info:function(e){this._message("info",e)},error:function(e){this._message("error",e)},clear:function(){e.$broadcast("message.clear")},_message:function(t,n){e.$broadcast("message.posted",{type:t,text:n,time:new Date})}}}]).controller("MessageController",["$scope","$timeout","$rootScope",function(e,t,n){e.controller="MessageController",e.persistDuration=12e3,e.historicCount=10,e.message=null,e.historic=[],n.$on("message.posted",function(n,o){var r=e.$root.$$phase;"$apply"==r||"$digest"==r?e.message=o:this.$apply(function(){e.message=o}),t.cancel(e.timeout),e.timeout=t(function(){e.$apply(function(){e.removeMessage()})},e.persistDuration)}),n.$on("message.cleared",e.removeMessage),e.removeMessage=function(){for(e.timeout=null,e.historic.splice(0,1,e.message);e.historic.length>10;)e.historic.pop();e.message=null}}]).run(["$rootScope","messageService",function(e,t){e.$on("message:info",function(e,n){t.info(n)}),e.$on("message:error",function(e,n){t.error(n)}),e.$on("message:success",function(e,n){t.success(n)}),e.$on("message:warn",function(e,n){t.warn(n)}),e.$on("message:clear",function(){t.warn(message)}),e.$on("messages",function(t,n){n=n?angular.isArray(n)?n:[n]:[],angular.forEach(n,function(t){e.$broadcast("message:"+t.type.toLowerCase(),t.text)})})}]).run(["$templateCache",function(e){e.put("components/message/messages.html",'<span ng-controller="MessageController" style="z-index:3">  <span ng-show="historic.length > 10000">    <a href="javascript:;" title="Show recent messages"><i class="fa fa-comments-o" style="color:black"></i></a>  </span>  <div ng-show="message" class="alert" role="alert" ng-class=\'{"alert-success":(message.type=="success"),"alert-info":(message.type=="info"),"alert-warning":(message.type=="warn"),"alert-danger":(message.type=="error")}\'>    {{message.text}} <a href="javascript:;" ng-click="removeMessage()"><i class="fa fa-times-circle" style="font-size:120%"></i></a>  </div></div>')}]),angular.module("explorer.modal",[]).directive("expModal",["$document","$animate","modalService",function(e,t,n){return{restrict:"EA",transclude:!0,replace:!0,scope:{iconClass:"@",title:"@",containerStyle:"@",template:"=",placement:"@",animation:"&",onClose:"&",isOpen:"=",isModal:"="},templateUrl:"components/modal/modal.html",link:function(e,t){function o(t){27==t.which&&(t.stopPropagation(),t.preventDefault(),e.$apply(function(){e.isOpen=!1}))}e.$watch("isOpen",function(r,i){r?(t.css("zIndex",n.index()),t.on("keyup",o)):(t.off("keyup",o),r!=i&&(n.closed(),e.onClose())),e.$on("$destroy",function(){t.off("keyup",o)})})}}}]).directive("expModalUp",["$document","$animate","modalService",function(e,t,n){return{link:function(e,t){t.on("mousedown",function(o){e.isModal&&(e.modalIndex=n.index()),t.css("zIndex",n.index())})}}}]).factory("modalService",[function(){var e=1030,t=e,n=0;return{index:function(){return 0==n&&(t=e),n++,t++},closed:function(){n--,0>n&&(n=0)}}}]),angular.module("explorer.persist",["explorer.projects"]).provider("persistService",function(){var e=null;this.$get=["persistLocalService","persistRemoteService",function(t,n){return"local"==e?t:n}],this.handler=function(t){e=t}}).factory("persistRemoteService",["$log","$q","projectsService","serverPersistService","userService",function(e,t,n,o,r){return{setGlobalItem:function(e,t){this._setItem("_system",e,t)},setItem:function(e,t){n.getCurrentProject().then(function(n){this._setItem(n,e,t)}.bind(this))},_setItem:function(t,n,i){e.debug("Fetching state for key "+n),r.getUsername().then(function(e){sessionStorage.setItem("mars."+e+"."+t+"."+n,JSON.stringify(i)),o.persist(t,n,i)})},getGlobalItem:function(e){return this._getItem("_system",e)},getItem:function(e){var o=t.defer();return n.getCurrentProject().then(function(t){this._getItem(t,e).then(function(e){o.resolve(e)})}.bind(this)),o.promise},_getItem:function(n,i){e.debug("Fetching state for key "+i);var a=t.defer();return r.getUsername().then(function(e){var t=sessionStorage.getItem("mars."+e+"."+n+"."+i);if(t){try{t=JSON.parse(t)}catch(r){}a.resolve(t)}else o.retrieve(n,i).then(function(e){a.resolve(e)},function(e){})}),a.promise}}}]).factory("serverPersistService",["httpData","projectsService","userService","$q",function(e,t,n,o){return{persist:function(t,n,r){var i=o.defer();if(angular.isString())try{JSON.parse(r)}catch(a){r='"'+r+'"'}return e.post("service/state/item/"+t+"/"+n,r).then(function(e){i.resolve(e)}),i.promise},retrieve:function(t,n){return e.get("service/state/item/"+t+"/"+n)}}}]).factory("persistLocalService",["$log","$q","projectsService",function(e,t,n){return{setGlobalItem:function(e,t){this._setItem("_system",e,t)},setItem:function(e,t){n.getCurrentProject().then(function(n){this._setItem(n,e,t)}.bind(this))},_setItem:function(t,n,o){e.debug("Fetching state for key locally"+n),localStorage.setItem("mars.anon."+t+"."+n,JSON.stringify(o))},getGlobalItem:function(e){return this._getItem("_system",e)},getItem:function(e){var o=t.defer();return n.getCurrentProject().then(function(t){this._getItem(t,e).then(function(e){o.resolve(e)})}.bind(this)),o.promise},_getItem:function(n,o){e.debug("Fetching state locally for key "+o);var r=localStorage.getItem("mars.anon."+n+"."+o);if(r)try{r=JSON.parse(r)}catch(i){}return t.when(r)}}}]),angular.module("explorer.ping",[]).provider("pingService",function(){var e="service/ping/keepalive",t=600,n=!0,o=null;this.location=function(t){e=t},this.enable=function(e){n=e},this.$get=["$http","$timeout",function(r,i){function a(){n&&r.post(e),o=i(a,1e3*t)}var s={enable:function(e){enable(e)},period:function(e){t=e},start:function(){}};return a(),s}]}),angular.module("explorer.popover",[]).directive("expPopover",[function(){return{templateUrl:"components/popover/popover.html",restrict:"A",transclude:!0,scope:{closeOnEscape:"@",show:"=",containerClass:"=",direction:"@"},link:function(e,t){function n(t){27==t.which&&(t.stopPropagation(),t.preventDefault(),e.$apply(function(){e.show=!1}))}e.direction||(e.direction="bottom"),!e.closeOnEscape||e.closeOnEscape!==!0&&"true"!==e.closeOnEscape||t.on("keyup",n)}}}]).run(["$templateCache",function(e){e.put("components/popover/popover.html",'<div class="popover {{direction}}" ng-class="containerClass" ng-show="show">  <div class="arrow"></div>  <div class="popover-inner" ng-transclude></div></div>')}]),angular.module("mars.print",[]).directive("marsPrintMap",[function(){return{template:'<i class="fa fa-print"></i>',link:function(e,t){t.on("click",function(){window.print()})}}}]),function(e){"use strict";e.module("explorer.projects",[]).provider("projectsService",function(){var e="<NONE>";this.$get=["$q","$timeout","$http",function(t,n,o){var r="service/appConfig/projects?t=";return{getCurrentProject:function(){return t.when(e)},getProjects:function(){var e=t.defer();return this.projects&&n(function(){e.resolve(this.projects)}.bind(this)),o.get(r+(new Date).getTime()).then(function(t){this.projects=t,e.resolve(this.projects)}.bind(this)),e.promise}}}],this.setProject=function(t){e=t}})}(angular),angular.module("explorer.resizelistener",[]).directive("resizeListener",function(e){return function(t,n){var o=angular.element(e);t.getWindowDimensions=function(){return{h:o.height(),w:o.width()}},t.$watch(t.getWindowDimensions,function(e,n){t.windowHeight=e.h,t.windowWidth=e.w,t.style=function(){return{height:e.h-100+"px",width:e.w-100+"px"}}},!0),o.bind("resize",function(){t.$apply()})}}),angular.module("mars.splitter",[]).directive("marsExpand",["$rootScope","$timeout",function(e,t){return{link:function(n,o,r){var i=function(){var t=$("#horizontal").data("kendoSplitter");n.marsRightView==r.marsExpand?(t.collapse(".mainSplitterRight"),n.marsRightView=null):(t.expand(".mainSplitterRight"),n.marsRightView=r.marsExpand,e.$broadcast("show.right.panel",r.marsExpand))};o.on("click",function(){t.cancel(n.marsRightExpandTimeout),i()}),o.on("mouseenter",function(e){n.marsRightExpandTimeout=t(i,400)}),o.on("mouseleave",function(){t.cancel(n.marsRightExpandTimeout)}),e.$on("right.tab.deselected",function(){t(function(){$("#horizontal").data("kendoSplitter").collapse(".mainSplitterRight"),n.marsRightView=null})})}}}]).directive("marsSplitter",["$rootScope","$timeout","mapService",function(e,t,n){return{link:function(o,r,i){var a=this;n.getMap().then(function(e){this.map=e}.bind(this)),r.kendoSplitter({panes:[{collapsible:!1},{collapsible:!0,collapsed:!0,size:"360px"}],resize:function(e){setTimeout(function(){var e=r.find(".rightPane").width()+7;$(".marsExpandContainer").css("right",e+"px"),a.map&&a.map.updateSize()},0)}}),e.$on("vertical.tab.deselected",function(){t(function(){r.data("kendoSplitter").collapse(".rightPane")})})}}}]).controller("MapSlideController",["$scope","$rootScope","$timeout",function(e,t,n){e.controller="MapSlideController",e.scrollTop=0,e.filterNames={point:!0,line:!0,area:!0,network:!0},e.cancelHide=function(){n.cancel(e.hideTimeout)},e.delayedRightHide=function(){e.pinnedRight||(e.hideRightTimeout=n(function(){e.lastView="",t.$broadcast("right.tab.deselected")},3e3))},e.cancelRightHide=function(){n.cancel(e.hideRightTimeout)},e.show=function(o){n.cancel(e.showTimeout),o==e.lastView?e.showTimeout=n(function(){e.lastView="",t.$broadcast("vertical.tab.deselected")},400):n(function(){e.lastView=o,t.$broadcast("vertical.tab.selected",o)},400)},e.$on("pinned.right.changed",function(t,n){e.pinnedRight=n}),e.$on("pinned.left.changed",function(t,n){e.pinnedLeft=n}),e.remove=function(){remove(this.feature)},e.toggleShow=function(e){e||(e=this.feature),e.displayed=e.handleShow()},e.viewLegend=function(e){}}]),angular.module("nedf.splash",["explorer.projects"]).directive("marsSplash",["$rootScope","$modal","$log","userService",function(e,t,n,o){return{controller:["$scope","splashService",function(e,t){e.acceptedTerms=!0,t.getReleaseNotes().then(function(t){e.releaseMessages=t,e.acceptedTerms=o.hasAcceptedTerms()})}],link:function(r,i){var a;r.$watch("acceptedTerms",function(e){e||(a=t.open({templateUrl:"partials/splash.html",size:"lg",backdrop:"static",keyboard:!1,controller:["$scope","$modalInstance","acceptedTerms","messages",function(e,t,n,o){e.acceptedTerms=n,e.messages=o,e.accept=function(){t.close(!0)}}],resolve:{acceptedTerms:function(){return r.acceptedTerms},messages:function(){return r.messages}}}),a.result.then(function(e){n.info("Accepted terms"),r.acceptedTerms=e,o.setAcceptedTerms(e)},function(){n.info("Modal dismissed at: "+new Date)}))}),e.$on("logoutRequest",function(){o.setAcceptedTerms(!1)})}}}]).factory("splashService",["$http","$q","projectsService",function(e,t,n){function o(e){e?sessionStorage.setItem(i,!0):sessionStorage.removeItem(i)}function r(){return!!sessionStorage.getItem(i)}var i="nedf.accepted.terms",a="service/releaseNotes/";return{getReleaseNotes:function(){var o=t.defer();return n.getCurrentProject().then(function(t){e({method:"GET",url:a+t+"?t="+Date.now()}).then(function(e){o.resolve(e.data)})}),o.promise},hasViewedSplash:r,setHasViewedTerms:o}}]).filter("priorityColor",[function(){var e={IMPORTANT:"red",HIGH:"blue",MEDIUM:"orange",LOW:"gray"};return function(t){return t in e?e[t]:"black"}}]).filter("wordLowerCamel",function(){return function(e){return e.charAt(0)+e.substr(1).toLowerCase()}}).filter("sortNotes",[function(){return function(e){var t=e.slice(0).sort(function(e,t){return e.priority==t.priority?e.lastUpdate==t.lastUpdate?0:t.lastUpdate-e.lastUpdate:"IMPORTANT"==e.priority?-11:1});return t}}]),angular.module("explorer.switch",[]).directive("explorerSwitch",[function(){return{restrict:"EA",scope:{disabled:"=",onLabel:"@",offLabel:"@",knobLabel:"@",model:"="},template:'<div role="radio" class="toggle-switch" ng-class="{ \'disabled\': disabled }"><div class="toggle-switch-animate" ng-class="{\'switch-off\': !model, \'switch-on\': model}"><span class="switch-left switch-text" ng-bind="onLabel"></span><span class="switch-label-text" ng-bind="knobLabel"></span><span class="switch-right switch-text" ng-bind="offLabel"></span></div></div>',link:function(e,t){e.onLabel||(e.onLabel="On"),e.offLabel||(e.offLabel="Off"),e.knobLabel||(e.knobLabel="Â "),e.disabled||(e.disabled=!1),t.on("click",function(){e.$apply(e.toggle)}),e.toggle=function(){e.disabled||(e.model=!e.model)}}}}]),angular.module("explorer.tabs",[]).controller("tabsController",["$scope","$document",function(e,t){var n=300,o=window.innerWidth||document.documentElement.clientWidth,r=540;e.view="",e.contentWidth=0,e.contentLeft=0,e.winHeight=window.innerHeight||document.documentElement.clientHeight,e.setView=function(t){e.view===t?(e.view="",r=e.contentWidth,e.contentWidth=0,e.contentLeft=0):(e.view=t,e.contentWidth=r,e.contentLeft=e.contentWidth)},e.catchResize=function(){function n(t){e.doResize(t)}function o(){
t.off("mousemove",n),t.off("mouseup",o)}t.on("mousemove",n),t.on("mouseup",o)},e.doResize=function(t){var i=o-t.pageX;i=i>n?i:n,e.contentWidth=i,e.contentLeft=i,r=i,e.$apply()},e.callback=function(){}}]),angular.module("explorer.tabs.left",[]).controller("tabsLeftController",["$scope","$document",function(e,t){var n=400,o=(window.innerWidth||document.documentElement.clientWidth,700);e.view="",e.contentWidth=0,e.winHeight=window.innerHeight||document.documentElement.clientHeight,e.setView=function(t){e.view===t?(e.view="",o=e.contentWidth,e.contentWidth=0):(e.view=t,e.contentWidth=o)},e.catchResize=function(){function n(t){e.doResize(t)}function o(){t.off("mousemove",n),t.off("mouseup",o)}t.on("mousemove",n),t.on("mouseup",o)},e.doResize=function(t){var r=t.pageX+2;r=r>n?r:n,e.contentWidth=r,o=r,e.$apply()}}]),angular.module("explorer.toolbar",[]).directive("expToolbar",[function(){return{restrict:"AE",scope:!0,controller:["$scope",function(e){e.item="",e.parameters={},e.toggleItem=function(t){e.item=e.item==t?"":t},this.toggleItem=function(t){e.item=e.item==t?"":t},this.currentItem=function(){return e.item}}]}}]),angular.module("explorer.user",[]).directive("marsUserDetails",["userService","$rootScope","$location",function(e,t,n){return{restrict:"EA",templateUrl:"components/user/userdetails.html",link:function(t,n,o){e.getUsername().then(function(e){t.username=e})}}}]).provider("userService",function(){var e="service/appConfig/status";this.url=function(t){e=t},this.$get=["$http","$q","$timeout",function(t,n,o){function r(){window.location.reload()}function i(e){e?sessionStorage.setItem("mars.accepted.terms",!0):sessionStorage.removeItem("mars.accepted.terms")}function a(){return!!sessionStorage.getItem("mars.accepted.terms")}function s(){return t.get(e+"?time="+(new Date).getTime())}var c;return{login:function(){r()},hasAcceptedTerms:function(){return a()},setAcceptedTerms:function(e){i(e)},getUsername:function(){var e;return c?n.when(c):(e=n.defer(),s().then(function(t){t&&(c=t.data.username),e.resolve(c)}),e.promise)}}}]}),angular.module("explorer.usermaps",["explorer.persist.local","explorer.flasher","explorer.vector"]).directive("addMaps",["userMapService","persistService","flashService","vectorService",function(e,t,n,o){return{templateUrl:"components/usermaps/addmaps.html",controller:["$scope",function(r){function i(e,t,n){if(n>=e.length)for(var o=n-e.length;o--+1;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}function a(e){var t={};return angular.forEach(u,function(n,o){t[o]=e[o]}),t}function s(){r.status.edit&&c()}function c(){var e=[];r.maps&&r.maps.forEach(function(t){e.push(a(t))}),t.setItem("userMaps",e)}function l(t){return t.isWrapped?t:(t.isWrapped=!0,t.layer||e.addLayer(t,!1),t.handleShow=function(){return this.layer.setVisibility(this.layer.visibility?!1:!0),this.layer.visibility},t)}var u={assetId:"",name:"",description:"",url:"",legendUrl:"",layers:[],projection:"EPSG:3857",thumbnailUrl:""},p="";t.getItem("userMaps").then(function(e){e?(e.forEach(function(e){angular.isString(e.layers)&&(e.layers=e.layers.split(","))}),r.maps=e):r.maps=[],p=JSON.stringify(r.maps)}),o.restore().then(function(e){r.vectors=e}),r.active=null,r.status={mapOpen:!1,vectorOpen:!1},r.clearOpen=function(){r.status.mapOpen=r.status.vectorOpen=!1},r.setOpen=function(e){r.clearOpen(),r.status[e+"Open"]=!0},r.work=angular.copy(u),r.editMap=function(){r.status.edit=!0,r.status.editDisplayed=this.map.displayed,r.setOpen("map"),r.work=this.map,n.add("Updates are immediately saved.",3e3)},r.toggleShow=function(){e.toggleShow(this.map)},r.makeActive=function(){r.active=l(this.map)},r.addMap=function(){var t=r.work;r.status.edit?r.status.edit=!1:(t.assetId="map"+Date.now(),r.maps.push(t)),e.removeLayer(t),r.clearOpen(),r.work=angular.copy(u),n.add("Your map has been saved.",3e3),c()},r.addLayer=function(){var t=!1,o=this.workLayer.trim();o&&(r.work.layers.forEach(function(e){t|=e==o}),t?n.add("Duplicate layer names are not allowed",3e3):(n.add("Refreshing view with new layer.",3e3),r.work.layers.push(o),this.workLayer="",e.refreshLayer(r.work,!0),s()))},r.shuffleUp=function(){var t=r.work.layers.indexOf(this.layer);0!=t&&(n.add("Refreshing view with new layer order.",3e3),i(r.work.layers,t,t-1),e.refreshLayer(r.work,!0),s())},r.shuffleDown=function(){var t=r.work.layers.indexOf(this.layer);t!=r.work.layers.length-1&&(n.add("Refreshing view with new layer order.",3e3),i(r.work.layers,t,t+1),e.refreshLayer(r.work,!0),s())},r.removeLayer=function(){var t=r.work.layers.indexOf(this.layer);r.work.layers.splice(t,1),r.work.layers.length?n.add("Refreshing view with new layer order.",3e3):n.add("No preview of map with no layers.",3e3),e.refreshLayer(r.work,!0),c()},r.clear=function(){r.work=angular.copy(u),r.status.edit=!1,r.clearOpen()},r.isTestable=function(){return r.work&&r.work.url&&r.work.layers},r.isComplete=function(){return r.isTestable()&&r.work.name},r.removeMap=function(){var t=r.maps.indexOf(this.map);t>-1&&(e.removeLayer(this.map),r.maps.splice(t,1),this.map==r.active&&(r.active=null)),r.status.edit=!1,c()},r.$watch("removalCandidate",function(e){}),r.$watch("status.open",function(t,n){"map"!=t&&"map"==n&&(e.refreshLayer(r.work,r.status.editDisplayed),r.work=angular.copy(u),r.status.edit=!1,r.status.editDisplayed=!1,c())})}]}}]).factory("userMapService",["mapService","$q",function(e,t){return{toggleShow:function(e){e.layer&&e.layer.map?this.removeLayer(e):this.addLayer(e)},refreshLayer:function(e,n){var o;return e.layer?(o=t.defer(),this.removeLayer(e).then(function(t){n&&(this.addLayer(e),o.resolve(e))}.bind(this)),o.promise):n&&e.url&&e.layers&&e.layers.length>0?this.addLayer(e):t.when(e)},addLayer:function(n,o){var r=t.defer();if("undefined"==typeof o&&(o=!0),n.displayed=o,n.layer){if(n.layer.map)return n.layer.setVisibility(o),t.when(n);e.getMap().then(function(e){e.addLayer(n.layer),r.resolve(n)})}else n.type="WMS",n.param1=n.url,n.param2={layers:n.layers,transparent:!0},n.param3={visibility:o,isBaseLayer:!1,opacity:1,legend:n.legend},n.layer=e.createLayer(n),e.getMap().then(function(e){e.addLayer(n.layer),r.resolve(n)});return t.promise},removeLayer:function(n){if(n.layer&&n.layer.map){var o=t.defer();return e.getMap().then(function(e){e.removeLayer(n.layer),n.layer=null,n.displayed=!1,o.resolve(n)}),o.promise}return t.when(n)}}}]),angular.module("explorer.vector",["explorer.flasher","explorer.broker","explorer.persist.local","explorer.message","explorer.config"]).directive("marsVectorEdit",["vectorService","flashService","persistService","brokerService","messageService","configService",function(e,t,n,o,r,i){return{templateUrl:"components/usermaps/vectorEdit.html",require:"^addMaps",link:function(t){i.getConfig().then(function(e){t.localClientSessionId=e.localClientSessionId},function(e){}),o.register("addVectorData",{process:function(n){if(n.data){var o=n.data,i={id:"userVector_"+(new Date).getTime(),name:o.vectorName.content,description:o.vectorDescription.content,dataStr:o.vectorFile.content,fileName:o.vectorFile.fileName,show:!0};i.layer=e.createLayer(i.dataStr,i),i.layer?(t.vectors[i.name]=i,e.persist(t.vectors)):r.error("No GML or KML features found. Are you sure that was a valid vector data file?")}}}),t.saveVectors=function(){t.cancelVectorEdit(),e.persist(t.vectors)},t.cancelVectorEdit=function(){t.clearOpen(),t.status.vectorEdit=!1,t.editVector=null},t.clearVector=function(){}}}}]).directive("vectorsDisplay",["vectorService",function(e){return{templateUrl:"components/usermaps/vectorDisplay.html?v=1",restrict:"AE",require:"^addMaps",link:function(t,n){t.showElevation=function(){e.showElevation(this.vector)},t.showFeatureElevation=function(){e.showElevation(this.vector,this.feature)},t.isPath=function(){return this.vector.layer&&this.vector.layer.features&&1==this.vector.layer.features.length&&this.vector.layer.features[0].geometry&&"OpenLayers.Geometry.LineString"==this.vector.layer.features[0].geometry.CLASS_NAME},t.isFeaturePath=function(){return this.feature.geometry&&("OpenLayers.Geometry.LineString"==this.feature.geometry.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==this.feature.geometry.CLASS_NAME)},t.toggle=function(){this.vector.show?e.hideLayer(this.vector.layer):e.showLayer(this.vector.layer),this.vector.show=!this.vector.show},t.remove=function(){e.hideLayer(this.vector.layer),delete t.vectors[this.vector.name],e.persist(t.vectors)},t.vectorEdit=function(){t.editVector=this.vector,t.setOpen("vector"),t.status.vectorEdit=!0},t.panToVector=function(){e.panTo(this.vector.layer)},t.panToFeature=function(){e.panToFeature(this.feature)}}}}]).directive("ajaxForm",["flashService","$rootScope","asynch","configService",function(e,t,n,o){return{scope:{update:"&",cancel:"&"},link:function(o,r){var i;o.quit=function(){o.cancel()},r.ajaxForm({beforeSubmit:function(r,a,s){o.cancel(),n.expect(),s.dataType="xml",t.safeApply(function(){i=e.add("Processing file...",4e3)})},success:function(n){t.safeApply(function(){e.remove(i)})}})}}}]).service("vectorService",["mapService","persistService","$q","$rootScope",function(e,t,n,o){var r,i="userVectorLayers",a={},s="http://www.opengis.net/gml",c="http://www.opengis.net/wfs",l="http://www.opengis.net/kml";return e.getMap().then(function(e){r=e}),{_whatType:function(e){return e?e.indexOf(l)>-1?"kml":e.indexOf(c)>-1?"wfs":e.indexOf(s)>-1?"gml":void 0:null},_boundsPlusPercent:function(e,t){var n=(e.right-e.left)*t,o=(e.top-e.bottom)*t;return new OpenLayers.Bounds(e.left-n,e.bottom-o,e.right+n,e.top+o)},persist:function(e){var n=[];angular.forEach(e,function(e){var t={id:e.id,name:e.name,description:e.description,dataStr:e.dataStr,show:e.show};n.push(t)}),t.setItem(i,n,!0)},restore:function(){var o=this,r=n.defer();return e.getMap().then(function(e){t.getItem(i).then(function(e){var t={};e&&e.forEach(function(e){e.show=!1,e.layer=o.createLayer(e.dataStr,e),e.dataStr&&e.name&&e.id&&(t[e.name]=e)}),r.resolve(t)})}),r.promise},createLayer:function(e,t){var n,o=a[t.name],i=this._whatType(e);return o||("kml"==i?n=new OpenLayers.Format.KML({internalProjection:r.baseLayer.projection,externalProjection:new OpenLayers.Projection("EPSG:4326"),extractAttributes:!0,extractStyles:!0}):("wfs"==i||"gml"==i)&&(n=new OpenLayers.Format.GML({internalProjection:r.baseLayer.projection,externalProjection:new OpenLayers.Projection("EPSG:4326"),extractAttributes:!0,extractStyles:!0})),n&&(o=new OpenLayers.Layer.Vector(t.name),o.addFeatures(n.read(e)),a[t.name]=o)),o&&t.show&&!o.map&&r.addLayer(o),o},showLayer:function(e){this.hideLayer(e),r.addLayer(e)},hideLayer:function(e){e.map&&r.removeLayer(e)},panTo:function(t){var n=this._boundsPlusPercent(t.getDataExtent(),.2);e.getMap().then(function(e){e.zoomToExtent(n)})},panToFeature:function(t){t.geometry.calculateBounds();var n=this._boundsPlusPercent(t.geometry.bounds,.2);e.getMap().then(function(e){t.geometry.calculateBounds(),e.zoomToExtent(n)})},showElevation:function(e,t){t||(t=e.layer.features[0]);var n=t.geometry,r=n.clone().transform(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")).getGeodesicLength(),i={length:r,geometry:n,heading:"KML"};o.$broadcast("elevation.plot.data",i)}}}]),angular.module("explorer.version",[]).directive("marsVersionDisplay",["$http","versionService",function(e,t){return{templateUrl:"components/version/versionDisplay.html",link:function(n){e.get(t.url()).then(function(e){n.version=e.data.version})}}}]).provider("versionService",function(){var e="service/appConfig/version";this.url=function(t){e=t},this.$get=function(){return{url:function(){return e}}}}),angular.module("explorer.waiting",[]).factory("waiting",["$q",function(e){function t(){this.waiting=[],this.length=0,this.waiter=function(){var t=e.defer();return this.waiting.push(t),this.length++,t},this.resolve=function(e){this.waiting.forEach(function(t){t.resolve(e)}),this.waiting=[],this.length=0},this.reject=function(e){this.waiting.forEach(function(e){e.reject(result)}),this.waiting=[],this.length=0},this.notify=function(e){this.waiting.forEach(function(e){e.notify(result)})}}return{wait:function(){return new t}}}]),angular.module("mars.zoom",[]).directive("marsZoomExtent",["zoomService","flashService",function(e,t){return{restrict:"AE",scope:{item:"="},link:function(n,o,r){function i(){var o=n.item,r="zoomIn"==o?"":"zoomIn";"zoomIn"==o?e.deactivateBoundingBox():"zoomIn"==r&&(t.add("Drag diagonally to zoom to an area",4e3),e.activateBoundingBox().then(function(t){n.item="",e.zoomTo(t)})),n.item=r}o.on("click",i)}}}]).directive("marsZoomOutExtent",["zoomService",function(e){return{template:'<i class="fa fa-search-minus"></i>',link:function(t,n,o){n.on("click",function(){e.zoomOut()})}}}]).factory("zoomService",["mapService","$log","$q",function(e,t,n){var o,r,i={};return{activateBoundingBox:function(){return i.deferred=n.defer(),null==o?(r=new OpenLayers.Layer.Vector("Prepare to define an area to zoom to"),o=new OpenLayers.Control.DrawFeature(r,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0},featureAdded:function(){t.debug("Bounding box drawn"),e.getMap().then(function(){var e=r.features[0],t=e.geometry.clone().getBounds();o.deactivate(),r.destroyFeatures(),i.deferred.resolve(t)})}}),e.getMap().then(function(e){e.addLayer(r),e.addControl(o),o.activate()})):o.activate(),i.deferred.promise},zoomTo:function(e){r.map.zoomToExtent(e)},zoomOut:function(){e.getMap().then(function(e){var t,n=e.zoom;n<=e.getMinZoom()||(t=10>n?n-1:13>n?n-2:n-3,e.zoomTo(t))})},deactivateBoundingBox:function(){this.isActiveBoundingBox()&&o.deactivate(),r&&r.removeAllFeatures()},isActiveBoundingBox:function(){return null!=o&&o.active},destroyBoundingBox:function(){o&&e.getMap().then(function(e){e.removeControl(o),e.removeLayer(r),o.destroy(),o=r=null})}}}]);